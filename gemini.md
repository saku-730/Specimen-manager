# 標本・採集管理サイト

## 要件

- データベースをもつ
- webアプリで動作する
- webアプリでデータベースを操作、データベース自体はローカルで保存
- 研究単位などでプロジェクト分け
- フロントエンドにNext.jsを使う
- バックエンドとしてGOのGinを使う

### データベース

なるべく柔軟で将来性のあるものを

### ページ構造

#### トップページ

サイトの顔。各ページヘのリンクが主な役割

データ入力ページ、一覧検索ページ、設定ページ、ユーザー管理ページヘのリンクがサイトのタブバーである。

メインにはデータの入力履歴を一行ごと最大10行まで簡易表示する。入力頻度をGithubの色のグラフみたいなので表示。

#### データ入力ページ

データ入力のみに使うページ。基本は一個体ごと入力だが多くの個体がまとまって見つかった場合などはまとめて一つの入力とする。その場合、個別ページも一つにまとめられる。

ユースケースとして1回の採集で複数の種、個体のデータが得られることが多いと思うので連続入力のON/OFFを切り替え可能にする。ONのときはいくつかのデータ項目が最初に入力したものを引き継いで入力している状態にする。

連続入力ON時点で引き継ぎデータ項目(使う人ごとに設定変更可能)

- 入力日時
- 天気
- 採集方法
- 採集者
- 降水量
- 気温

#### 個別標本・採集ページ

1つの標本/採集(観察)に1つのページがつくられる。1つのページ内にはその採集時点でのデータと標本についてのデータを表示。ここで設定したデータは基本の入力データ形式である。各ユーザーによって項目を追加可能とする。虫屋がいじらなくても使えるwebアプリであるだけでなくこだわりのあるガチユーザーがいじれるようにする。

表示するデータ これに加えて写真は無限に追加可能。

採集・観察について 年月日・時間のタイムゾーンはユーザーの設定している地点のタイムゾーン。

- 場所:基本は緯度経度。地名でも可
- 年月日
- 時間 1時間単位 31分以降は次の時間 例 15:20→15, 11:49→12, 11:31 →12, 11:30→11
- 採集方法
- 採集・観察者
- 個体数
- 天気
- 気温
- 湿度
- 降水量(天気の選択によって自動的に0入力)
- 環境(森林、草原、稲田etc)
- 備考

標本について

- 標本作成者
- 標本種類(液浸、乾燥etc)
- 標本所在地
- 標本箱、サンブル番号(標本所在地内での細かいID)
- 標本作成日(期間)
- 備考

共通

- 雌雄
- 種名(学名・和名)
- 年齢・成体/幼体
- 同定者
- プロジェクト名
- データ入力日
- データ変更履歴:変更箇所と理由、変更者を記録。
- 備考

ユースケース

すべての場合において共通は表示

1. 採集して標本まで作成

1つのページに採集関連のデータ(採集日時、場所等)と標本のデータ(同定者、標本の場所等)を表示。

2. 採集・観察のみ

採集・観察だけして標本は作らなかった場合、1つのページに採集についてのデータだけ表示。標本データについてはすべて空白状態。

3. 標本のみ

未整理の標本をとりあえずデータベースに追加したいという場合、1つのページに標本から読み取れる採集情報と標本の情報を表示。採集については部分的に空白。

#### 一覧検索ページ

そのタグが含まれる個別ページを一覧表示する。タグ的な役割で検索に使う。

タグ的な役割をするのは人(同定者、採集者、データ入力担当、標本作成者)、各分類レベル(種、属etc)、プロジェクト、標本箱、採集場所、日時(採集・観察と標本で別)。複数タグを選択可能。

各分類レベルでの一覧表示では更に上位段階でのsp表示を含むかどうかを選択可能。

例 シマミミズっぽいけど断定できなくて *Eisenia.sp* にした個別データがある場合

種名：*Eisenia fetida* で検索をしたとき

sp含む なら上記の個別データも一覧上に表示。

sp含まず なら上記のデータは表示せず。

#### ユーザー作成個別ページ

標本の作成方法や採集方法などについて個別で記録したいときに使う。Wikipediaとかwordpressみたいにweb上で簡単にページを編集できるようにする。そのページについてのリンクを標本種類などの個別標本・採集ページの項目につくれる。

例 標本種類：ミミズ液浸(エタノール)

↑みたいにしたら 「ミミズ液浸(エタノール)」がユーザー作成個別ページのリンクになっている。

#### 写真

採集・観察と標本で代表を各1枚、合計2枚まで選択可能。それをページの上部に表示。それ以外の写真も一覧でページ下部に表示。

写真のダウンロードについては

1. 一枚ごとにダウンロード
2. 採集・観察での写真をダウンロード
3. 標本の写真をダウンロード
4. すべての写真をダウンロード
5. 選択した写真をダウンロード

のダウンロード方法を用意。5だけは保留。

## TODO

### 必ずやる

- フロントエンド実装
- データ入力フォームのドロップダウンリスト候補の設定追加(天気、環境、年：etc)
- 緯度経度から逆ジオコーディング
- ユーザー管理・ログイン画面
- github連携
- README.mdをちゃんと書く
- 生物種データベースと連携して、種名から上位分類を自動挿入
- 分類段階ごとに入力、検索
- sp含むは同定されていないものを含む

### やったほうがいいかも

- 地名からジオコーディング
- ユーザー作成個別ページ
- 使わなくなった写真消去
- 写真以外の添付ファイル(鳴き声の音声とか動画とか)
- 添付ファイルのファイル名編集・自動変更
- sqlight→postgrasqlへ移行
- データ編集履歴の保存、閲覧
- rsyncでデータをNASに移して本体から添付ファイルを削除
- 
